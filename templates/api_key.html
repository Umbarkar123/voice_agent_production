{% extends "layout.html" %}
{% block content %}

<div class="page-header">
    <h1>API Key Management</h1>
    <p class="subtitle">Generate and manage API keys for client integrations</p>
</div>

<div class="card full">

    <!-- ===== Generate API Key Form ===== -->
   <form method="POST" class="api-form">
    <div class="form-row">
        <label>Select Client</label>

        <select name="client_id" required>
    {% for c in clients %}
       <option value="{{ c._id }}">

            {{ c.company_name }} ({{ c.email }})
        </option>
    {% endfor %}
</select>


        <button type="submit" class="save-btn">
            Generate API Key
        </button>
    </div>
</form>


    <!-- ===== API Keys Table ===== -->
    <table class="calls-table">
        <thead>
            <tr>
                <th>Client</th>
                <th>API Key</th>
                <th>Created At</th>
            </tr>
        </thead>

        <tbody>
        {% if keys %}
            {% for k in keys %}
            <tr>
               <td>
    <strong>{{ k.client_name }}</strong><br>
    <span style="color:#9ca3af; font-size:12px;">
        {{ k.client_email }}
    </span>
</td>


             <td class="key-cell">
    <code id="key{{ loop.index }}">{{ k.api_key }}</code>

    <button onclick="copyKey('key{{ loop.index }}')" class="copy-btn">
        Copy
    </button>

    <a href="/regenerate-key/{{ k._id }}" class="regen-btn">
        Regenerate
    </a>

    <a href="/revoke-key/{{ k._id }}" class="revoke-btn">
        Revoke
    </a>
</td>



                <td>
    {% if k.createdAt %}
        {{ k.createdAt.strftime("%Y-%m-%d %H:%M") }}
    {% else %}
        -
    {% endif %}
</td>

            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="3" style="text-align:center; padding:20px; color:#9ca3af;">
                    No API keys generated yet.
                </td>
            </tr>
        {% endif %}
        </tbody>
    </table>

</div>

<style>
/* ===== API FORM ===== */
.api-form{
    margin-bottom:25px;
}

.form-row{
    display:flex;
    gap:15px;
    align-items:center;
    flex-wrap:wrap;
}

.form-row label{
    font-weight:600;
    min-width:120px;
}

.form-row select{
    padding:10px 12px;
    border-radius:6px;
    border:1px solid #334155;
    background:#0f172a;
    color:white;
    min-width:280px;
}

.form-row select:focus{
    border:1px solid #facc15;
    outline:none;
}

/* ===== API KEY STYLE ===== */
.key-cell code{
    background:#0f172a;
    padding:6px 10px;
    border-radius:6px;
    border:1px solid #334155;
    font-size:13px;
    color:#facc15;
}
.subtitle{
    color:#9ca3af;
    margin-top:4px;
}
.copy-btn{
    margin-left:8px;
    padding:4px 8px;
    border:none;
    background:#facc15;
    color:black;
    border-radius:4px;
    cursor:pointer;
    font-size:12px;
}
.form-row{
    position: relative;
    z-index: 5;
}

.form-row select{
    position: relative;
    z-index: 10;
}
.card{
    overflow: visible;
}
.regen-btn{
    margin-left:8px;
    padding:4px 8px;
    background:#0ea5e9;
    color:white;
    border-radius:4px;
    text-decoration:none;
    font-size:12px;
}

.revoke-btn{
    margin-left:6px;
    padding:4px 8px;
    background:#ef4444;
    color:white;
    border-radius:4px;
    text-decoration:none;
    font-size:12px;
}



</style>
<script>
function copyKey(id){
    const text = document.getElementById(id).innerText;
    navigator.clipboard.writeText(text);
    alert("API Key copied!");
}
function filterClient(id){
    window.location.href = "/api-key?client=" + id;
}
</script>


{% endblock %}
